<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Conversion1</title>
        <!-- PAGE CSS -->
        <link rel="stylesheet" type="text/css" href="<?php echo BASE_PATH;?>/css/classicTheme/style.css" />
        <link href="<?php echo BASE_PATH;?>/css/stylesheet.css" type="text/css" rel="stylesheet" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="<?php echo BASE_PATH;?>/js/jquery.js"></script>
        <script type="text/javascript" src="<?php echo BASE_PATH;?>/js/ajaxupload-min.js"></script>
        <script type="text/javascript" src="<?php echo BASE_PATH;?>/js/jquery.easyui.min.js"></script>
        <script src="<?php echo BASE_PATH;?>/js/conversion.js"  type="text/javascript" ></script>
        <script>
            var siteUrl = "<?PHP echo ROOT_URI ?>";
            var taskId = "<?PHP echo $wftId ?>";
        </script>
        <style type="text/css">
            <?php $lineheight = 16; /* do not decrease below 16. This is a minimum forced by icon size */ ?>
            body{ line-height :<?php echo "$lineheight"; ?>px; }
            .mainContent{padding:10px 50px 50px 50px !important;}
        </style>
        <script>
            var siteUrl = "<?PHP echo ROOT_URI ?>";
            var dir = "<?php echo $_GET['dir'];?>";
            var dir2 = "<?php echo $_GET['dir2'];?>";
            $(document).ready(function() {
                if (dir != '' || dir2 != '') {
                    if (dir2 != '' && dir2 != '/') {
                        $("#watchFolder").css('display', 'block');
                        $("#propertiesTab").hide();
                    }
                    if ((dir == '' && dir == '/') && (dir2 == '' && dir2 == '/')) {
                        $("#watchFolder").css('display', 'none');
                    }
                } else {
                    $("#watchFolder").css('display', 'none');
                }
            });
        </script>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css" />
        <script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
        <style>
            #gallery { float: left; width: 65%; min-height: 6em; }
            .gallery.custom-state-active { background: #eee; }
            .gallery li { float: left; width: 120px; padding: 0.4em; margin: 0 0.4em 0.4em 0; text-align: center; }
            .gallery li h5 { margin: 0 0 0.4em; cursor: move; }
            .gallery li a { float: right; }
            .gallery li a.ui-icon-zoomin { float: left; }
            .gallery li img { width: 100%; cursor: move; }
            #trash {width: 100%; min-height: 18em; padding: 1%; }
            #trash h4 { line-height: 16px; margin: 0 0 0.4em; }
            #trash h4 .ui-icon { float: left; }
            #trash .gallery h5 { display: none; }
            .ui-widget-content{ border:0px solid #aaaaaa !important;}
            .ui-helper-reset{padding: 7% 0 0 29% !important;float: left !important;}
        </style>
        <script>
            $(function() {
                // there's the gallery and the trash
                var $gallery = $("#gallery"),
                        $trash = $("#trash");
                // let the gallery items be draggable
                $("li", $gallery).draggable({
                    cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                    revert: "invalid", // when not dropped, the item will revert back to its initial position
                    containment: "document",
                    helper: "clone",
                    cursor: "move"
                });
                // let the trash be droppable, accepting the gallery items
                $trash.droppable({
                    accept: "#gallery > li",
                    activeClass: "ui-state-highlight",
                    drop: function(event, ui) {
                        deleteImage(ui.draggable);
                    }
                });
                // let the gallery be droppable as well, accepting items from the trash
                $gallery.droppable({
                    accept: "#trash li",
                    activeClass: "custom-state-active",
                    drop: function(event, ui) {
                        var tbVal;
                        var arrVal = [];
                        for (var i = 1; i <= 3; i++) {
                            tbVal = $.trim($("#dragDropVal" + i).val());
                            if ($("#dragDropVal" + i).length) {
                                arrVal.push(tbVal);
                            }
                        }
                        if (arrVal.length == '1') {
                            $(".placeHolder").css('display', 'block');
                        }
                        recycleImage(ui.draggable);
                    }
                });
                // image deletion function
                var recycle_icon = "";
                function deleteImage($item) {
                    var dataVal = $item.find('img').attr('data-val');
                    var arrKey;
                    if (dataVal == '1') {
                        arrKey = 'wd';
                    } else if (dataVal == '2') {
                        arrKey = 'fxml';
                    } else if (dataVal == '3') {
                        arrKey = 'arrow';
                    }
                    $("#dragDropConfig").append("<input type='hidden' name='dragDropVal[]' id='dragDropVal" + dataVal + "' value=" + arrKey + ">");
                    var tbVal;
                    var valStatus = true;
                    var arrVal = [];
                    for (var i = 1; i <= 3; i++) {
                        tbVal = $.trim($("#dragDropVal" + i).val());
                        if (isNaN(tbVal)) {
                            arrVal.push(tbVal);
                        } else {
                            valStatus = false;
                        }
                    }
                    if (valStatus) {
                        if (arrVal.length == 3) {
                            $.post(siteUrl + "application/controller/task_controller.php", {
                                tId: taskId,
                                tVal: arrVal,
                                type: 'status_update_task'
                            }, function(data, status) {
                                if (status == 'success') {
                                } else {
                                }
                            });
                        }
                    }
                    $(".placeHolder").css('display', 'none');
                    $item.fadeOut(function() {
                        var $list = $("ul", $trash).length ?
                                $("ul", $trash) :
                                $("<ul class='gallery ui-helper-reset'/>").appendTo($trash);
                        $item.find("a.ui-icon-trash").remove();
                        $item.append(recycle_icon).appendTo($list).fadeIn(function() {
                            $item
                                    .animate({width: "120px"})
                                    .find("img")
                                    .animate({height: "120px"});
                        });
                    });
                }
                // image recycle function
                var trash_icon = "";
                function recycleImage($item) {
                    var dataVal = $item.find('img').attr('data-val');
                    $("#dragDropVal" + dataVal).remove();
                    $item.fadeOut(function() {
                        $item
                                .find("a.ui-icon-refresh")
                                .remove()
                                .end()
                                .css("width", "120px")
                                .append(trash_icon)
                                .find("img")
                                .css("height", "120px")
                                .end()
                                .appendTo($gallery)
                                .fadeIn();
                    });
                }
            });
        </script>
    </head>
    <body> 
        <!-- .............  wrapper starts ...................  -->
        <div id="wrapper">
            <div class='innerwrapper'>
                <!-- .............  Left navigation ...................  -->
                <div id="leftNav">
                    <div class="forLOgo"><a href="index.php"><img src="<?php echo BASE_PATH;?>/images/logo.png" /></a></div>
                    <div id="mainNav">
                        <ul>
                            <li><a href="workflow.php?id=<?php echo $wfId['id'];?>"><?php echo ucfirst($wfData['wf_name']);?></a></li>
                            <li><a href="task-list.php?id=<?php echo $wfId['id'];?>">Task List</a></li>
                        </ul>
                    </div>
                    <div class="actionIco">
                        <a href="javascript:void(0)" onclick="switchTask('watchFolder')"><img src="<?php echo BASE_PATH;?>/images/Watch-folder.png" /><span>Watch Folder</span></a>
                        <a href="javascript:void(0)" onclick="switchTask('fixedToXML')"><img src="<?php echo BASE_PATH;?>/images/Convert_Icon.png" /><span>Fixed To XML</span></a>
                    </div>
                </div>
                <!-- .............  right content  ...................  -->
                <div id="rightContent">
                    <div class="rightHead">
                        <a href="#"><img src="<?php echo BASE_PATH;?>/images/setting.png" /></a>
                        <a href="#" class="userName">Some User Name</a>

                        <div class="sideEdge"></div>
                    </div>
                    <div class="mainContent">
                        <!--Drag N Drop-->
                        <div class="ui-widget ui-helper-clearfix">
                            <ul id="gallery" class="gallery ui-helper-reset1 ui-helper-clearfix">
                                <li class="ui-widget-content ui-corner-tr">
                                    <img src="<?php echo BASE_PATH;?>/images/Watch-folder.png" data-val="1" width="120" height="120" />
                                </li>
                                <li class="ui-widget-content ui-corner-tr">
                                    <img src="<?php echo BASE_PATH;?>/images/Convert_Icon.png" data-val="2" width="120" height="120" />
                                </li>
                                <li class="ui-widget-content ui-corner-tr">
                                    <img src="<?php echo BASE_PATH;?>/images/arrow.jpeg" data-val="3" width="120" height="120" />
                                </li>
                            </ul>
                        </div>
                        <div class="forSholder">
                            <ul>
                                <li>
                                    <div class="rowHolderN">
                                        <div class="holders" id="trash">

                                        </div>
                                        <p class="placeHolder">User can drag and drop the task and connect them together to from an input and output workflow</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!--  Watch Folder Start -->
                    <div class="tabData padding-bottom-20" id="watchFolder">
                        <div class="tabHead">
                            <ul>
                                <li>
                                    <a href="#">Watch Folder<span onclick="switchTask('watchFolderCross')"></span></a>
                                </li>
                            </ul>
                        </div>
                        <div class="tabCont padding-left-45">
                            <form id="THEFORMWF" action="application/controller/save_config_wd.php" method="post">
                                <table class="options">
                                    <tr>
                                        <td>
                                            <fieldset>
                                                <legend>Source Directory Path</legend>
                                                <?php if ($inputlabel) { ?>
                                                <input id=dir type=hidden value="<?php                                                      
                                                       echo $dir; ?>" />
                                                       <input id=path type="text" readonly="readonly" class="tablename" name="folderpath" value="<?php  $pieces = explode("/", $dir);
                                                       $len = count($pieces);
                                                       $i=3;
                                                       while ($i<$len){
                                                       $dir =  "/".$pieces[$i++];echo ($targetfile) ? $targetfile : $dir;} ?>"
                                                       <?php } else { ?>
                                                       <div style="width: 600px">&nbsp;</div>	
                                                        <input id=path type=hidden name="dir" value="<?php echo $dir; ?>">
                                                            <?php } ?>
                                                            </fieldset>
                                                            <fieldset>
                                                                <legend>Select Source Directory</legend>
                                                                <div class="float-left">
                                                                    <!-- and the file table itself -->
                                                                    <table align="center" border="0" class="table-style" cellpadding="1" cellspacing="3">
                                                                        <tr><td align="left" valign="top">
                                                                                <?php if ($showfiles) { ?>
                                                                                <table width="700" border="0" align="center">
                                                                                    <tr bgcolor="#E1EEF4" height="22">
                                                                                        <td align="left">Name</td>
                                                                                        <td align="center" width="80">Size</td>
                                                                                        <td align="center" width="80">Permission</td>
                                                                                        <td align="center" width="150">Date Modified</td>
                                                                                    </tr>
                                                                                </table>
                                                                                <?php
                                                                                $maxlines = $ischild ? 8 : 15;
                                                                                $verticalsize = $maxlines * $lineheight + 2;  // 2px of cellpadding for the empty <thead>
                                                                                ?>
                                                                                <?php if ($body_count < $maxlines) { /* no scollbar */ ?>
                                                                                <table width="700" border="0" align="center">
                                                                                    <thead><td width="80"></td><td width="80"></td><td width="150"></td></thead>
                                                                                    <?php echo $body; ?>
                                                                                </table>
                                                                                <?php } else { ?>
                                                                                <div style="height: <?php echo $verticalsize; ?>px; width: 700px; margin-left: auto ; margin-right: auto ;overflow: auto;">
                                                                                    <table width="682" border="0" align="center">
                                                                                        <?php echo $body; ?>
                                                                                    </table>
                                                                                </div>
                                                                                <?php } ?>
                                                                                <?php } ?>
                                                                            </td></tr>
                                                                    </table>
                                                                </div>
                                                                <div class="padding-top-10"></div>
                                                            </fieldset>
                                                            <br/>
                                                            <fieldset>
                                                                <legend>Destination Directory Path</legend>
                                                                <?php if ($inputlabel2) { ?>
                                                                <input id=dir type=hidden value="<?php echo $dir2; ?>">
                                                                    <input id=path type="text" readonly="readonly" class="tablename" name="destfolderpath" value="<?php
                                                                           $pieces = explode("/", $dir2);
                                                                           $len = count($pieces);
                                                                           $i=3;
                                                                           while ($i<$len){
                                                                           $dir2 =  "/".$pieces[$i++];
            
                                                                           echo ($targetfile2) ? $targetfile2 : $dir2;
                                                                           } ?>"
                                                                           <?php if (!$secondchance2) echo "readonly"; ?>
                                                                           <?php } else { ?>
                                                                           <div style="width: 600px">&nbsp;</div>	
                                                                        <input id=path type=hidden name="dir" value="<?php echo $dir2; ?>">
                                                                            <?php } ?>
                                                                            </fieldset>
                                                                            <fieldset>
                                                                                <legend>Select Source Directory</legend>
                                                                                <div class="float-left">
                                                                                    <!-- and the file table itself -->
                                                                                    <table align="center" border="0" class="table-style" cellpadding="1" cellspacing="3">
                                                                                        <tr><td align="left" valign="top">
                                                                                                <?php if ($showfiles2) { ?>
                                                                                                <table width="700" border="0" align="center">
                                                                                                    <tr bgcolor="#E1EEF4" height="22">
                                                                                                        <td align="left">Name</td>
                                                                                                        <td align="center" width="80">Size</td>
                                                                                                        <td align="center" width="80">Permission</td>
                                                                                                        <td align="center" width="150">Date Modified</td>
                                                                                                    </tr>
                                                                                                </table>
                                                                                                <?php
                                                                                                $maxlines2 = $ischild2 ? 8 : 15;
                                                                                                $verticalsize2 = $maxlines2 * $lineheight + 2;  // 2px of cellpadding for the empty <thead>
                                                                                                ?>
                                                                                                <?php if ($body_count2 < $maxlines2) {		/* no scollbar */ ?>
                                                                                                <table width="700" border="0" align="center">
                                                                                                    <thead><td width="80"></td><td width="80"></td><td width="150"></td></thead>
                                                                                                    <?php echo $body2; ?>
                                                                                                </table>
                                                                                                <?php } else { ?>
                                                                                                <div style="height: <?php echo $verticalsize2; ?>px; width: 700px; margin-left: auto ; margin-right: auto ;overflow: auto;">
                                                                                                    <table width="682" border="0" align="center">
                                                                                                        <?php echo $body2; ?>
                                                                                                    </table>
                                                                                                </div>
                                                                                                <?php } ?>
                                                                                                <?php } ?>
                                                                                            </td></tr>
                                                                                    </table>
                                                                                </div>
                                                                                <div class="padding-top-10"></div>
                                                                            </fieldset>
                                                                            </td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td>
                                                                                    <br/>
                                                                                    <fieldset>
                                                                                        <legend>File Converse Configuration</legend>
                                                                                        <?php echo $selOpt; ?>
                                                                                        <div class="padding-top-10"></div>
                                                                                    </fieldset>
                                                                                    <fieldset>
                                                                                        <div class="padding-top-10"></div>
                                                                                        <div class="text-align-center">
                                                                                            <div id="dragDropConfig"> </div>
                                                                                            <input type="hidden" id="save_sch" name="save_sch_id" value="<?php echo $_GET['id'];?>"> 
                                                                                                <button type="submit" class="btn-class-common">Save Schedule</button>
                                                                                        </div>
                                                                                        <div class="padding-top-10"></div>
                                                                                    </fieldset>
                                                                                </td>
                                                                            </tr>
                                                                            </table>
                                                                            </form>
                                                                            </div>
                                                                            </div>
                                                                            <!--  Fixed To XML Start -->
                                                                            <div class="tabData padding-bottom-20 display-none" id="fixedToXML">
                                                                                <div class="tabHead">
                                                                                    <ul>
                                                                                        <li>
                                                                                            <a href="#">Fixed To XML<span onclick="switchTask('fixedToXMLCross')"></span></a>
                                                                                        </li>
                                                                                    </ul>
                                                                                </div>
                                                                                <div class="tabCont padding-left-45">
                                                                                    <form id="THEFORM" action="application/controller/xmlconvert.php" method="post">
                                                                                        <table class="options">
                                                                                            <tr>
                                                                                                <td>
                                                                                                    <div id="uploader_div"></div>
                                                                                                    <fieldset>
                                                                                                        <legend>Uploaded File Content</legend>
                                                                                                        <textarea rows="6" cols="79" readonly="readonly" name="filetext" id="filetext"></textarea><br/>
                                                                                                        <input type="text" value="" readonly="readonly" size="57" name="filecontent" id="filecontent" />
                                                                                                        <div class="padding-top-10"></div>
                                                                                                    </fieldset>
                                                                                                </td>
                                                                                            </tr>
                                                                                            <tr>
                                                                                                <td>
                                                                                                    <div id="uploader_div"></div>
                                                                                                    <fieldset>
                                                                                                        <legend>Select Configuration</legend>
                                                                                                        <div class="padding-top-5">
                                                                                                            <?php echo $selOpt; ?>
                                                                                                            OR 
                                                                                                            <input type="text" value="" class="tablename" placeholder="Add New Config" id="newconfig" name="newconfig" />
                                                                                                        </div>
                                                                                                    </fieldset>
                                                                                                    <fieldset>
                                                                                                        <legend>Add Table</legend>
                                                                                                        <div class="padding-top-5">
                                                                                                            <input type="text" value="" class="tablename" placeholder="Table Name" id="tablename" name="tablename" />
                                                                                                        </div>
                                                                                                        <div class="padding-top-10"></div>
                                                                                                    </fieldset>
                                                                                                    <fieldset>
                                                                                                        <legend>Add Fields</legend>
                                                                                                        <div class="padding-top-5">
                                                                                                            <input type="text" onchange="updateValue(this.value, '0')" placeholder="Location" value="" class="location" id="location0" name="location[]" />
                                                                                                            <input type="text" value="" placeholder="Field Name" id="field0" name="field[]" />
                                                                                                            <input type="text" value="" id="value0" name="value0" readonly="readonly" />
                                                                                                        </div>
                                                                                                        <div id="TextBoxesGroup"></div>
                                                                                                        <div class="add-field">
                                                                                                            <input type="button" value="Add Field" class="add-field-button" onclick="addField()" />
                                                                                                        </div>
                                                                                                        <div class="padding-top-10"></div>
                                                                                                        <div class="batch-individual">
                                                                                                            <input type="hidden" value="" id="filename" name="filename" readonly="readonly" />
                                                                                                            Batch <input type="radio" name="filetype" value="batch" value="Run" />  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                                                            Individual <input type="radio" value="individual" checked="checked" name="filetype" value="Run" />  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                                                                            <input type="hidden" name="txttoxml" value="1">
                                                                                                            <button type="submit" class="btn-class-common">Run</button>
                                                                                                            </form>
                                                                                                            
                                                                                                        </div>
                                                                                                        <div class="padding-top-10"></div>
                                                                                                    </fieldset>
                                                                                                </td>
                                                                                            </tr>
                                                                                        </table>
                                                                                    
                                                                                </div>
                                                                            </div>
                                                                            <div class="tabData" id="propertiesTab">
                                                                                <div class="tabHead">
                                                                                    <ul>
                                                                                        <li>
                                                                                            <a href="#">Properties<span></span></a>
                                                                                        </li>
                                                                                    </ul>
                                                                                    <a href="#" class="upInd"><img src="<?php echo BASE_PATH;?>/images/arrowUp.png" /></a>
                                                                                </div>
                                                                                <div class="tabCont">
                                                                                    <ul>
                                                                                        <li>
                                                                                            <label class="fields">Item Type</label>
                                                                                            <label class="descp">Item Description</label>                                     
                                                                                        </li>
                                                                                        <li>
                                                                                            <label class="fields">Item Type</label>
                                                                                            <label class="descp">Item Description</label>                                     
                                                                                        </li>
                                                                                        <li>
                                                                                            <label class="fields">Item Type</label>
                                                                                            <label class="descp">Item Description</label>                                     
                                                                                        </li>
                                                                                        <li>
                                                                                            <label class="fields">Item Type</label>
                                                                                            <label class="descp">Item Description</label>                                     
                                                                                        </li>
                                                                                    </ul>
                                                                                </div>
                                                                            </div> 
                                                                            </div>
                                                                            </div>
                                                                            </div>
                                                                            </body>
                                                                            <script type="text/javascript">
                                                                                $('#uploader_div').ajaxupload({
                                                                                    url: 'upload.php',
                                                                                    remotePath: 'public/uploaded_files/',
                                                                                    maxFileSize: '10G',
                                                                                    allowExt: ['txt']
                                                                                });
                                                                            </script>
                                                                            <script type="text/javascript">
                                                                                $(function() {
                                                                                    $('#THEFORM').form({
                                                                                        success: function(data) {
                                                                                            alert(data);
                                                                                        }
                                                                                    });
                                                                                });
                                                                                $(function() {
                                                                                    $('#THEFORMWF').form({
                                                                                        success: function(data) {
                                                                                            alert(data);
                                                                                        }
                                                                                    });
                                                                                });
                                                                            </script>
                                                                            </html>
